<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مهیار ❤️ آرام - بازی نقطه‌خط آنلاین</title>
<style>
    body {
        background: linear-gradient(to bottom, #ffd6e0, #ffc0cb);
        font-family: sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    h1 {
        color: #fff;
        margin-top: 20px;
        font-size: 28px;
    }
    h2 {
        color: #fff;
        font-size: 18px;
        margin: 10px 0;
    }
    #board {
        display: grid;
        margin: 20px auto;
        background-color: white;
        border-radius: 15px;
        padding: 15px;
        box-shadow: 0px 4px 20px rgba(0,0,0,0.1);
    }
    .dot {
        width: 14px;
        height: 14px;
        background-color: black;
        border-radius: 50%;
    }
    .cell {
        background-color: transparent;
        border: none;
        outline: none;
    }
    .line-h {
        border-top: 3px solid transparent;
        cursor: pointer;
    }
    .line-v {
        border-left: 3px solid transparent;
        cursor: pointer;
    }
    .line-h.active {
        border-top-color: #ff4d6d;
    }
    .line-v.active {
        border-left-color: #ff4d6d;
    }
    .box {
        background-color: transparent;
    }
    .box.taken1 {
        background-color: rgba(255,77,109,0.3);
    }
    .box.taken2 {
        background-color: rgba(77,136,255,0.3);
    }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-7eEYJd1bfG4l1q42y_xtSQvb6AG4d1g",
  authDomain: "aram-mahyar.firebaseapp.com",
  projectId: "aram-mahyar",
  storageBucket: "aram-mahyar.firebasestorage.app",
  messagingSenderId: "27948148575",
  appId: "1:27948148575:web:b4357896d424bd0fe0b8ea",
  measurementId: "G-5LPNKQ7DD5",
  databaseURL: "https://aram-mahyar-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const size = 5;
let turn = "mahyar";
let boardState = [];

const boardEl = document.createElement("div");
boardEl.id = "board";
boardEl.style.gridTemplateColumns = `repeat(${size*2-1}, 30px)`;
document.addEventListener("DOMContentLoaded", () => {
    document.body.appendChild(boardEl);
    drawBoard();
    syncWithFirebase();
});

function drawBoard() {
    boardState = [];
    for (let r = 0; r < size*2-1; r++) {
        boardState[r] = [];
        for (let c = 0; c < size*2-1; c++) {
            let el = document.createElement("div");
            if (r % 2 === 0 && c % 2 === 0) {
                el.className = "dot";
            } else if (r % 2 === 0 && c % 2 === 1) {
                el.className = "line-h cell";
                el.addEventListener("click", () => clickLine(r, c, "h"));
            } else if (r % 2 === 1 && c % 2 === 0) {
                el.className = "line-v cell";
                el.addEventListener("click", () => clickLine(r, c, "v"));
            } else {
                el.className = "box cell";
            }
            boardEl.appendChild(el);
            boardState[r][c] = "";
        }
    }
}

function clickLine(r, c, type) {
    if (boardState[r][c] !== "") return;
    boardState[r][c] = turn;
    updateBoardUI();
    saveToFirebase();
    turn = turn === "mahyar" ? "aram" : "mahyar";
}

function updateBoardUI() {
    const cells = boardEl.children;
    let i = 0;
    for (let r = 0; r < size*2-1; r++) {
        for (let c = 0; c < size*2-1; c++) {
            const el = cells[i];
            if (boardState[r][c] !== "") {
                if (el.classList.contains("line-h")) el.classList.add("active");
                if (el.classList.contains("line-v")) el.classList.add("active");
            }
            i++;
        }
    }
}

function saveToFirebase() {
    set(ref(db, "game"), {
        boardState,
        turn
    });
}

function syncWithFirebase() {
    const gameRef = ref(db, "game");
    onValue(gameRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            boardState = data.boardState;
            turn = data.turn;
            updateBoardUI();
            document.querySelector("h2").textContent = `نوبت: ${turn === "mahyar" ? "مهیار" : "آرام"}`;
        }
    });
}
</script>
</head>
<body>
<h1>مهیار ❤️ آرام</h1>
<h2>نوبت: مهیار</h2>
</body>
</html>
